before_script:
  - sudo apt-get -y install build-essential cmake pkg-config libboost-serialization-dev libboost-program-options-dev libboost-filesystem-dev libboost-graph-dev libopencv-dev qtbase5-dev qtbase5-dev-tools libglibmm-2.4-dev

stages:
  - build
  # TODO add tests
  - test

# https://docs.gitlab.com/ee/ci/yaml/README.html#special-yaml-features
.job_template: &job_definition
  stage: build
  script:
    - if [ -d build/ ]; then rm -rf build/ ; fi
    - mkdir build/ && cd build/
    - cmake -DWITH_TESTS=OFF -DLIBUIPF_WITH_TESTS=OFF -DWITH_OPENCV=$WITH_OPENCV -DLIBUIPF_WITH_OPENCV=$WITH_OPENCV -DCMAKE_INSTALL_PREFIX=`pwd`/../prefix ../code
    - make -j 4
    - make install
  artifacts:
    paths:
      - prefix/

build-uipf-with-cv:
  <<: *job_definition
  variables:
    WITH_OPENCV: 'ON'

build-uipf-without-cv:
  <<: *job_definition
  variables:
    WITH_OPENCV: 'OFF'


variables:
  GIT_STRATEGY: clone
